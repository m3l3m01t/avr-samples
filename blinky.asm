.EQU DELAY_MS = 200
.EQU MHZ      = 16
.INCLUDE "m32def.inc"
.MACRO INITSTACK
	LDI R20,HIGH(RAMEND)
	OUT SPH,R20
	LDI R20,LOW(RAMEND)
	OUT SPL,R20
.ENDM

.ORG 0x000
	INITSTACK
	LDI R16,1<<7   ; R16 = 0x20
	SBI DDRB,5
	LDI R17,0
	OUT PORTC,R17  ; clear PC7

BEGIN:  RCALL DELAY
	EOR R17,R16
	OUT PORTC,R17  ; toggle PC7
	RJMP BEGIN

DELAY:
LOOP0:  LDI R22,200
LOOP0_1:LDI R21,16 * 10
LOOP1:  LDI R20,156 ; 100 ticks
	OUT TCNT0, R20
	LDI R18, 3
	OUT TIFR,R18
	LDI R18, 0b00001001
	OUT TCCR0,R18
LOOP2:  IN R20,TIFR
	SBRS R20,TOV0
	RJMP LOOP2     ; wait until timer overflow

	LDS R20,0b00001000
	OUT TCCR0,R20 ;clear timer 0
	DEC R21
	BRNE LOOP1    ; if (--R21) goto LOOP1

	DEC R22
	BRNE LOOP0_1  ; if (--R22) goto LOOP0_1
	RET
